# Практика 9. Сетевой уровень

## Задачи. Работа протокола TCP

### Задача 1. Докажите формулы (3 балла)
Пусть за период времени, в который изменяется скорость соединения с $\frac{W}{2 \cdot RTT}$
до $\frac{W}{RTT}$, только один пакет был потерян (очень близко к концу периода).
1. Докажите, что частота потери $L$ (доля потерянных пакетов) равна
   $$L = \dfrac{1}{\frac{3}{8} W^2 + \frac{3}{4} W}$$
2. Используйте выше полученный результат, чтобы доказать, что, если частота потерь равна
   $L$, то средняя скорость приблизительно равна
   $$\approx \dfrac{1.22 \cdot MSS}{RTT \cdot \sqrt{L}}$$

#### Решение
1. Частота потерь $\ { L }$ - отношение количества потерянных пакетов к количеству отправленных.

    Количество отправленных за цикл пакетов:

    $$\ W/2 + (W/2 + 1) + L + W = $$

    $$\ = W/2 * (W/2 + 1) + 1/2 * (W/2 * (W/2 + 1)) = $$

    $$\ = W^2 / 4 + W^2 / 8 + W / 4 + W / 2 = 3 * W^2 / 8 + 3 * W / 4 $$

    Так как потерянных всего один:

    $$\ L = 1 / (3 / 8 * W^2 + 3 / 4 * W) $$

2. Для окна размером $\ { W }$ имеет место сравнение:

    $$\ 3 / 8 * W^2 >> 3 / 4 * W $$

    Соотвественно, $\ L ≈ 8 / 3 * W^2 $. Отсюда:

    $$\ W ≈ \sqrt{8 / 3 * 1 / L} $$

    Тогда средняя скорость:

    $$\ = 3 / 4 * \sqrt{8 / 3 * 1 / L} * MSS/RTT = $$

    $$\ = 1.22 * MSS / (RTT * \sqrt{L}) $$


### Задача 2. Найдите функциональную зависимость (3 балла)
Рассмотрим модификацию алгоритма управления перегрузкой протокола TCP. Вместо
аддитивного увеличения, мы можем использовать мультипликативное увеличение. 
TCP-отправитель увеличивает размер своего окна в небольшую положительную 
константу $a$ ($a > 1$), как только получает верный ACK-пакет.
1. Найдите функциональную зависимость между частотой потерь $L$ и максимальным
размером окна перегрузки $W$.
2. Докажите, что для этого измененного протокола TCP, независимо от средней пропускной
способности, TCP-соединение всегда требуется одинаковое количество времени для
увеличения размера окна перегрузки с $\frac{W}{2}$ до $W$.

#### Решение
1. Общее число сегментов $\ {  S }$, отправленных в течение изменения размера окна:

    $$\ S = w / 2 + (w / 2) * (1 + a) + (w / 2) * (1 + a)^2 + $$

    $$\ + (w / 2) * (1 + a)^3 + ... + (w / 2) * (1 + a)^n $$

    где $\ n = log_{(1+a)}{2} $, тогда $\ S=w*(2a+1)/(2a) $

    Отсюда частота потерь равна:

    $$\ L = 1 / S = (2a) / (w*(2a+1))  $$

2.  Среднюю пропускную способность можно вычислить по формуле:

    $$\ B = MSS * S / ((n+1) * RTT) = MSS / (L * (k+1) * RTT)  $$

    Она несколько отличается от исходной.

    Чтобы увеличить размер окна, TCP затрачивает время, равное:

    $$\ n * RTT = log_{(1+a)}2 * RTT  $$

    что никак не зависит от пропускной способности соединения. Можно также заметить, что данная величина не изменяется, что и требовалось.

